# Infrastructure

## I. Kiến trúc Hệ thống (System Architecture)

* **Kiến trúc Microservices với Container:** Sử dụng kiến trúc microservices được containerized qua Docker và được điều phối bằng Kubernetes, triển khai trên máy chủ Windows 10/11.

  * **Ưu điểm:** Tách biệt các dịch vụ, dễ dàng phát triển độc lập, triển khai liên tục (CI/CD), mở rộng theo nhu cầu, khả năng phục hồi và tự động khắc phục lỗi.
  * **Thiết kế Module:** Hệ thống được chia thành các module chức năng rõ ràng theo yêu cầu từ brief, mỗi module là một microservice chạy trong container riêng biệt:
    * Giao tiếp (Messenger)
    * Lịch (Calendar)
    * Tài liệu (Docs)
    * Lưu trữ Đám Mây (Cloud Drive)
    * Email Tích Hợp
    * Quản lý Công Việc & Dự Án (Tasks/Projects)
    * Quy trình & Phê duyệt (Approval)
    * Hội nghị Trực tuyến (Video Conference)
    * Quản trị Hệ thống (Admin Console)
    * Nền tảng Mở (Open Platform)

* **API Gateway:** Triển khai dưới dạng container riêng biệt, đóng vai trò là điểm vào duy nhất cho tất cả các yêu cầu.
  * **Chức năng:** Định tuyến (routing) request đến các microservice phù hợp, xác thực và ủy quyền (authentication & authorization), giới hạn tần suất truy cập (rate limiting), logging tập trung.
  * **Công nghệ gợi ý:** Kong Gateway hoặc Traefik (đóng gói trong container).

* **Service Mesh (Tùy chọn):** Istio hoặc Linkerd nhẹ hơn để quản lý giao tiếp giữa các service, cung cấp bảo mật, theo dõi và kiểm soát lưu lượng.

* **Giao tiếp bất đồng bộ (Asynchronous Communication):**
  * **Sử dụng message broker** trong container để xử lý giao tiếp giữa các microservice.
  * **Công nghệ gợi ý:** RabbitMQ hoặc Kafka trong container.

## II. Công nghệ Frontend (Client-side)

### 1. Web Application:
   * **Framework/Library:** React với TypeScript (Hiện đại, hiệu năng tốt, cộng đồng lớn).
   * **Quản lý State:** Zustand (nhỏ gọn, hiệu năng cao, dễ học) hoặc Redux Toolkit.
   * **Build Tool:** Vite (nhanh, hiện đại, ít tài nguyên).
   * **UI Library:** Chakra UI hoặc Ant Design (Giao diện đẹp, responsive, nhiều component sẵn có).
   * **Real-time:** WebSocket thông qua thư viện Socket.IO client.
   * **Internationalization:** React-i18next để hỗ trợ đa ngôn ngữ (tối thiểu Tiếng Việt và Tiếng Anh).

### 2. Mobile Applications (iOS & Android):
   * **Cross-Platform:** Flutter (hiệu suất gần với native, cộng đồng lớn, UI đẹp) hoặc React Native (tận dụng codebase React).
   * **Thư viện HTTP Client:** Dio (Flutter) hoặc Axios (React Native).
   * **State Management:** Provider/Riverpod (Flutter) hoặc Zustand (React Native).
   * **Push Notifications:** Firebase Cloud Messaging (FCM) cho cả iOS và Android.

### 3. Desktop Applications (Windows, macOS):
   * **Framework:** Tauri (sử dụng WebView, hiệu suất tốt hơn Electron, nhẹ hơn, sử dụng ít tài nguyên hơn).
   * **Tích hợp:** Tauri cho phép sử dụng lại frontend web React.
   * **Tính năng Desktop:** Thông báo hệ thống, tray icon, khởi động cùng hệ thống.

## III. Công nghệ Backend (Server-side)

### Ngôn ngữ & Framework:
  * **Python 3.9+ với FastAPI:** Framework hiện đại, hiệu năng cao, hỗ trợ async/await, tự động tạo API docs, validation dựa trên Pydantic.
  * **Containerization:** Mỗi microservice được đóng gói vào Docker container riêng biệt.
  * **Orchestration:** Kubernetes để quản lý các container, scaling, self-healing và service discovery.

### Cấu trúc Project (Chia theo các microservice):
  * **Auth-Service:** Quản lý xác thực và phân quyền người dùng.
  * **Messenger-Service:** Module giao tiếp và nhắn tin.
  * **Calendar-Service:** Quản lý lịch và sự kiện.
  * **Docs-Service:** Hệ thống quản lý và cộng tác tài liệu.
  * **Drive-Service:** Lưu trữ đám mây và quản lý file.
  * **Email-Service:** Tích hợp và quản lý email.
  * **Tasks-Service:** Quản lý công việc và dự án.
  * **Approval-Service:** Quy trình và phê duyệt.
  * **Video-Service:** Hội nghị trực tuyến và video call.
  * **Admin-Service:** Bảng điều khiển quản trị.
  * **Platform-Service:** API và SDK cho nền tảng mở.
  * **Shared-Library:** Thư viện và tiện ích dùng chung, đóng gói thành container image cơ sở.

### Giao tiếp Thời gian thực:
  * **WebSockets:** Container chuyên biệt xử lý WebSocket connections.
  * **PubSub với Redis:** Container Redis để hỗ trợ real-time notifications và updates giữa các microservice.

### Hội nghị Trực tuyến (Video Conferencing):
  * **WebRTC:** Container riêng cho signaling server.
  * **STUN/TURN:** Container cho STUN/TURN server.
  * **SFU cho cuộc họp nhiều người:** Container MediaSoup hoặc LiveKit.

### Cộng tác Tài liệu Thời gian thực:
  * **Yjs:** Container riêng cho collaborative editing server.
  * **Document Store:** Lưu trữ tài liệu trong PostgreSQL hoặc MongoDB (containerized).

### Email Tích hợp:
  * **SMTP/IMAP Gateway:** Container riêng để xử lý kết nối email.

## IV. Cơ sở dữ liệu & Lưu trữ (Databases & Storage)

### Cơ sở dữ liệu Chính:
  * **PostgreSQL:** Container PostgreSQL với persistent volume storage.
  * **Sharding & Replication:** Tùy chọn cấu hình cho high availability và scaling.
  * **Connection Pooling:** PgBouncer trong container riêng.

### Cache & Session Management:
  * **Redis:** Container Redis với persistent storage tùy chọn.
  * **Redis Cluster:** Tùy chọn cấu hình cho high availability và scaling.

### Lưu trữ Tệp tin:
  * **Object Storage:** MinIO container cung cấp S3-compatible storage.
  * **Persistent Volumes:** Kubernetes PV/PVC để quản lý lưu trữ dữ liệu.
  * **Storage Classes:** Cấu hình các loại storage cho các nhu cầu khác nhau (performance, capacity).

### Tìm kiếm & Indexing:
  * **PostgreSQL Full Text Search:** Tận dụng tính năng của PostgreSQL.
  * **Elasticsearch (tùy chọn):** Container Elasticsearch cho tìm kiếm nâng cao.
  * **Elastic Stack:** Tận dụng Kibana, Logstash containers (tùy chọn).

## V. Hạ tầng & Triển khai (Infrastructure & Deployment)

### Máy chủ vật lý:
  * **Hệ điều hành:** Windows 10/11 Pro/Enterprise với WSL2 (Windows Subsystem for Linux).
  * **Docker Desktop for Windows:** với Kubernetes được kích hoạt.
  * **Yêu cầu khuyến nghị:** CPU 8+ cores, RAM 32GB+, SSD 1TB+.
  * **Kết nối mạng:** Ổn định, tốc độ upload tối thiểu 50Mbps, IP tĩnh hoặc DDNS.

### Kubernetes Cluster:
  * Single-node Kubernetes cluster chạy trên Docker Desktop.
  * Namespace phân chia: Tạo các namespace riêng cho môi trường dev, staging và production.
  * Resource Quotas: Quản lý giới hạn tài nguyên cho mỗi namespace và service.
  * Config Maps & Secrets: Quản lý cấu hình và thông tin nhạy cảm.

### Container Registry:
  * Local registry (Docker Registry container) hoặc Azure Container Registry (ACR)/Docker Hub.
  * Image tagging strategy: [service-name]:[semantic-version]

### CI/CD Pipeline:
  * GitHub Actions hoặc GitLab CI/CD: Tự động build, test Docker images và deploy lên Kubernetes.
  * GitOps approach sử dụng Flux hoặc ArgoCD (tùy chọn).
  * Deployment Strategies: Rolling updates, blue/green deployments.

### Ingress & Network:
  * **Ingress Controller:** NGINX Ingress Controller container.
  * **SSL/TLS:** Let's Encrypt với cert-manager container.
  * **Network Policies:** Kiểm soát traffic giữa các service.

### Giám sát & Logging:
  * Prometheus & Grafana containers cho monitoring.
  * EFK Stack containers (Elasticsearch, Fluentd, Kibana) cho logging tập trung.
  * Kubernetes Dashboard cho visibility.
  * Alerting: Alertmanager container với tích hợp email/Slack notifications.

### Backup & Disaster Recovery:
  * Velero container cho Kubernetes backup/restore.
  * Automated PostgreSQL backup containers.
  * Backup schedules và retention policies.

## VI. Bảo mật (Security)

### Xác thực (Authentication):
  * Auth Service container với JWT implementation.
  * OAuth2/OIDC Provider container (Keycloak).
  * MFA service container.

### Network Security:
  * Container-to-container encryption với service mesh.
  * Pod Security Policies hoặc Security Context.
  * Network Policies để giới hạn traffic giữa các service.

### Secrets Management:
  * Kubernetes Secrets với encryption at rest.
  * External Secrets Operator tích hợp với Azure Key Vault/HashiCorp Vault (tùy chọn).

### Container Security:
  * Image scanning (Trivy container).
  * Non-root container users.
  * Read-only filesystems khi có thể.
  * Resource limits và requests.

### Compliance & Auditing:
  * Audit logging container.
  * RBAC (Role-Based Access Control) trong Kubernetes.

## VII. Modules Chi tiết & Tính năng đặc biệt

### Module Giao tiếp (Messenger):
  * **Real-time Chat:** Sử dụng WebSockets để gửi/nhận tin nhắn ngay lập tức.
  * **Trạng thái Người dùng:** Hiển thị online/offline/đang gõ.
  * **Thông báo:** Đẩy thông báo cho tin nhắn mới, @mentions.
  * **Đa phương tiện:** Hỗ trợ gửi hình ảnh, tệp, liên kết với preview.
  * **Emoji & Reactions:** Hỗ trợ biểu tượng cảm xúc và phản ứng với tin nhắn.

### Module Lịch (Calendar):
  * **Event Management:** API để tạo, sửa, xóa và xem sự kiện.
  * **Recurring Events:** Hỗ trợ sự kiện lặp lại.
  * **Notifications:** Thông báo nhắc nhở trước sự kiện.
  * **Resource Booking:** Đặt phòng họp và tài nguyên với kiểm tra xung đột.
  * **Timezone Support:** Hiển thị sự kiện theo múi giờ người dùng.

### Module Tài liệu (Docs):
  * **Real-time Collaboration:** Sử dụng Yjs và WebSockets.
  * **Rich Text Editor:** Dựa trên ProseMirror hoặc TipTap.
  * **Spreadsheet:** Tính năng bảng tính cơ bản.
  * **Presentation:** Trình bày slide đơn giản.
  * **Versioning:** Quản lý phiên bản và lịch sử chỉnh sửa.
  * **Permission Control:** Quản lý ai có thể xem/chỉnh sửa/chia sẻ tài liệu.

### Module Lưu trữ Đám Mây (Cloud Drive):
  * **File Operations API:** Upload, download, di chuyển, đổi tên, xóa.
  * **Sharing System:** Chia sẻ với người dùng khác hoặc qua link.
  * **Versioning:** Lưu phiên bản tệp tin.
  * **Thumbnail Generation:** Tạo ảnh thu nhỏ cho hình ảnh và preview tệp phổ biến.
  * **Search:** Tìm kiếm theo tên, loại, nội dung tệp.

### Module Email Tích Hợp:
  * **SMTP/IMAP Client:** Kết nối với máy chủ email.
  * **Email Composer:** Soạn thảo email với định dạng rich text.
  * **Email Organization:** Phân loại và lọc email.
  * **Attachment Handling:** Gửi và nhận tệp đính kèm.
  * **Integration:** Tích hợp với Calendar, Tasks, và Docs.

### Module Quản lý Công Việc & Dự Án:
  * **Task Management:** API cho tạo, gán, theo dõi công việc.
  * **Project Organization:** Nhóm các công việc theo dự án.
  * **Views:** Hiển thị theo dạng danh sách, bảng Kanban, timeline.
  * **Subtasks & Dependencies:** Công việc con và phụ thuộc giữa các công việc.
  * **Notifications & Reminders:** Nhắc nhở deadline và cập nhật công việc.

### Module Quy trình & Phê duyệt:
  * **Workflow Designer:** API để xây dựng quy trình phê duyệt.
  * **Approval Routing:** Định tuyến yêu cầu tới người phê duyệt phù hợp.
  * **Status Tracking:** Theo dõi trạng thái của yêu cầu phê duyệt.
  * **Notifications:** Thông báo cho người liên quan về cập nhật trạng thái.
  * **Audit Trail:** Lưu lịch sử đầy đủ của quy trình phê duyệt.

### Module Hội nghị Trực tuyến:
  * **WebRTC Integration:** Cho video/audio call.
  * **Room Management:** Tạo, quản lý phòng họp.
  * **Screen Sharing:** Chia sẻ màn hình và ứng dụng.
  * **Recording:** Ghi lại cuộc họp.
  * **Whiteboard:** Bảng trắng kỹ thuật số để cộng tác.

### Module Quản trị Hệ thống (Admin Console):
  * **User Management:** API để quản lý người dùng, phòng ban, vai trò.
  * **System Configuration:** Cấu hình chung cho hệ thống.
  * **Monitoring:** Giám sát hiệu suất và hoạt động.
  * **Audit & Compliance:** Theo dõi hoạt động người dùng và admin.
  * **Backup & Restore:** Sao lưu và phục hồi dữ liệu.

### Module Nền tảng Mở (Open Platform):
  * **REST API:** API cho các ứng dụng bên ngoài.
  * **Webhooks:** Thông báo sự kiện ra ngoài.
  * **Authentication:** OAuth2 để xác thực ứng dụng bên thứ ba.
  * **SDK:** Thư viện hỗ trợ để phát triển tích hợp.
  * **Developer Portal:** Tài liệu và công cụ cho nhà phát triển.

## VIII. DevOps & Container Management

### Container Health Management:
  * Liveness và Readiness probes cho tất cả containers.
  * Horizontal Pod Autoscaler (HPA) dựa trên CPU/Memory usage.
  * Quality of Service (QoS) classes cho pods.

### Container Networking:
  * Service discovery thông qua Kubernetes Services.
  * CoreDNS cho DNS resolution.
  * CNI (Container Network Interface) sử dụng Calico hoặc Flannel.

### Resource Optimization:
  * Resource requests và limits được cấu hình cho tất cả containers.
  * Pod affinity/anti-affinity rules (khi mở rộng cluster).
  * Vertical Pod Autoscaler (VPA) cho resource optimization (tùy chọn).

### Storage Management:
  * CSI (Container Storage Interface) drivers.
  * Dynamic provisioning của persistent volumes.
  * Storage Classes cho các loại storage khác nhau.

### Development Workflow:
  * Local Kubernetes development với Skaffold/Tilt.
  * Docker Compose cho local development đơn giản.
  * Image tagging và versioning strategy.

## IX. Mở rộng & Tối ưu hóa

### Khi cần mở rộng:
  * Thêm worker nodes vào Kubernetes cluster.
  * Sử dụng horizontal pod autoscaling để tự động mở rộng theo tải.
  * Cân nhắc chuyển từ single-node cluster sang multi-node cluster.
  * Database replication và sharding.

### Tối ưu hóa hiệu năng:
  * Container resource tuning.
  * Database query optimization.
  * Redis caching strategy.
  * Service mesh traffic management.
  * CDN integration cho static assets.

### High Availability:
  * Multi-replica deployments cho critical services.
  * Pod disruption budgets.
  * Anti-affinity rules khi có multiple nodes.
  * Database clustering.

## Lưu ý:

* Kiến trúc này sử dụng Docker và Kubernetes để containerize và điều phối các microservices, giúp dễ dàng triển khai, quản lý và mở rộng.
* Mặc dù triển khai ban đầu trên một máy chủ Windows đơn lẻ, thiết kế này đã chuẩn bị sẵn sàng cho việc mở rộng lên multi-node cluster trong tương lai.
* WSL2 + Docker Desktop là cách tốt nhất để chạy Kubernetes trên Windows, nhưng cần cấu hình đúng để đạt hiệu suất tốt nhất.
* Sử dụng container cho tất cả các thành phần giúp đảm bảo môi trường nhất quán và dễ dàng nâng cấp/rollback.
