{% extends "base.html" %} {% block title %}Meeting Room - CSA Hello System{%
endblock %} {% block extra_css %}
<link rel="stylesheet" href="/meeting/static/css/video.css" />
<link rel="stylesheet" href="/meeting/static/css/notification.css" />
<style>
    .meeting-container {
        min-height: calc(100vh - 150px);
    }

    .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 15px;
    }

    .video-container {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        height: 0;
        overflow: hidden;
        border-radius: 8px;
    }

    .video-container video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #1f2937;
        object-fit: cover;
    }

    .video-container.main-video {
        grid-column: span 2;
        grid-row: span 2;
    }

    .video-controls {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        background-color: rgba(0, 0, 0, 0.5);
        padding: 10px 20px;
        border-radius: 50px;
        z-index: 100;
    }

    .control-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 5px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .control-btn i {
        font-size: 1.2rem;
    }

    .control-btn:hover {
        transform: scale(1.1);
    }

    .btn-mute {
        background-color: #4caf50;
        color: white;
    }

    .btn-mute.active {
        background-color: #f44336;
    }

    .btn-video {
        background-color: #2196f3;
        color: white;
    }

    .btn-video.active {
        background-color: #f44336;
    }

    .btn-screenshare {
        background-color: #9c27b0;
        color: white;
    }

    .btn-screenshare.active {
        background-color: #f44336;
    }

    .btn-leave {
        background-color: #f44336;
        color: white;
    }

    .btn-more {
        background-color: #607d8b;
        color: white;
    }

    .participant-name {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
    }

    .participant-muted {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(244, 67, 54, 0.7);
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
    }

    .meeting-sidebar {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .meeting-sidebar-header {
        padding: 15px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .meeting-tab-content {
        height: calc(100vh - 300px);
        overflow-y: auto;
    }

    .chat-messages {
        display: flex;
        flex-direction: column;
        padding: 15px;
        height: calc(100% - 60px);
        overflow-y: auto;
    }

    .chat-input {
        padding: 10px 15px;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    .message {
        margin-bottom: 15px;
        max-width: 80%;
    }

    .message-self {
        align-self: flex-end;
    }

    .message-others {
        align-self: flex-start;
    }

    .message-content {
        padding: 8px 12px;
        border-radius: 15px;
        position: relative;
    }

    .message-self .message-content {
        background-color: #4e73df;
        color: white;
        border-top-right-radius: 5px;
    }

    .message-others .message-content {
        background-color: #f1f3f4;
        color: #333;
        border-top-left-radius: 5px;
    }

    .message-header {
        margin-bottom: 5px;
        font-size: 12px;
        color: #6c757d;
    }

    .message-time {
        font-size: 10px;
        margin-top: 5px;
        text-align: right;
    }

    .message-self .message-time {
        color: rgba(255, 255, 255, 0.7);
    }

    .participant-list {
        padding: 0;
        list-style: none;
    }

    .participant-item {
        display: flex;
        align-items: center;
        padding: 8px 15px;
        border-bottom: 1px solid #f1f3f4;
    }

    .participant-item:hover {
        background-color: #f8f9fa;
    }

    .participant-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
    }

    .participant-info {
        flex: 1;
    }

    .participant-actions {
        display: flex;
    }

    .participant-actions button {
        background: none;
        border: none;
        font-size: 14px;
        padding: 5px;
        cursor: pointer;
        color: #6c757d;
        transition: color 0.2s;
    }

    .participant-actions button:hover {
        color: #4e73df;
    }

    .meeting-info {
        padding: 15px;
    }

    .meeting-code {
        background-color: #f1f3f4;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        margin-top: 10px;
        text-align: center;
        position: relative;
    }

    .copy-code {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #4e73df;
        cursor: pointer;
    }

    .network-status {
        margin-top: 15px;
    }

    .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
    }

    .status-good {
        background-color: #4caf50;
    }

    .status-ok {
        background-color: #ff9800;
    }

    .status-bad {
        background-color: #f44336;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .video-grid {
            grid-template-columns: 1fr;
        }

        .video-container.main-video {
            grid-column: span 1;
            grid-row: span 1;
        }

        .control-btn {
            width: 40px;
            height: 40px;
        }
    }
</style>
{% endblock %} {% block content %}
<div class="container-fluid px-0 meeting-container">
    <div class="row g-0">
        <!-- Main Video Area -->
        <div class="col-md-9 col-lg-10 px-4 py-3">
            <!-- Room Info Bar -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h2 class="h4 mb-0">Weekly Team Meeting</h2>
                    <p class="text-muted mb-0">
                        <small
                            ><i class="far fa-clock me-1"></i> Started 10
                            minutes ago</small
                        >
                    </p>
                </div>
                <div>
                    <span class="badge bg-success">Recording</span>
                    <button class="btn btn-sm btn-outline-primary ms-2">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

            <!-- Video Grid -->
            <div class="video-grid">
                <!-- Main Speaker -->
                <div class="video-container main-video">
                    <video
                        poster="/meeting/static/img/user-avatar-1.jpg"
                        autoplay
                        muted
                        playsinline
                    ></video>
                    <div class="participant-name">John Doe (You)</div>
                </div>

                <!-- Participant 1 -->
                <div class="video-container">
                    <video
                        poster="/meeting/static/img/user-avatar-2.jpg"
                        autoplay
                        playsinline
                    ></video>
                    <div class="participant-name">Sarah Miller</div>
                    <div class="participant-muted">
                        <i class="fas fa-microphone-slash"></i> Muted
                    </div>
                </div>

                <!-- Participant 2 -->
                <div class="video-container">
                    <video
                        poster="/meeting/static/img/user-avatar-3.jpg"
                        autoplay
                        playsinline
                    ></video>
                    <div class="participant-name">Michael Brown</div>
                </div>

                <!-- Participant 3 -->
                <div class="video-container">
                    <video
                        poster="/meeting/static/img/user-avatar-4.jpg"
                        autoplay
                        playsinline
                    ></video>
                    <div class="participant-name">Emily Wilson</div>
                    <div class="participant-muted">
                        <i class="fas fa-microphone-slash"></i> Muted
                    </div>
                </div>

                <!-- Participant 4 -->
                <div class="video-container">
                    <video
                        poster="/meeting/static/img/user-avatar-5.jpg"
                        autoplay
                        playsinline
                    ></video>
                    <div class="participant-name">Robert Johnson</div>
                    <div class="participant-muted">
                        <i class="fas fa-microphone-slash"></i> Muted
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 bg-white">
            <div class="meeting-sidebar h-100">
                <div class="meeting-sidebar-header">
                    <ul class="nav nav-tabs nav-fill" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button
                                class="nav-link active small"
                                id="chat-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#chat"
                                type="button"
                                role="tab"
                                aria-controls="chat"
                                aria-selected="true"
                            >
                                <i class="fas fa-comment-alt me-1"></i> Chat
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button
                                class="nav-link small"
                                id="people-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#people"
                                type="button"
                                role="tab"
                                aria-controls="people"
                                aria-selected="false"
                            >
                                <i class="fas fa-users me-1"></i> People
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button
                                class="nav-link small"
                                id="info-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#info"
                                type="button"
                                role="tab"
                                aria-controls="info"
                                aria-selected="false"
                            >
                                <i class="fas fa-info-circle me-1"></i> Info
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="tab-content meeting-tab-content">
                    <!-- Chat Tab -->
                    <div
                        class="tab-pane fade show active"
                        id="chat"
                        role="tabpanel"
                        aria-labelledby="chat-tab"
                    >
                        <div class="chat-messages">
                            <!-- Message 1 -->
                            <div class="message message-others">
                                <div class="message-header">
                                    <strong>Sarah Miller</strong>
                                </div>
                                <div class="message-content">
                                    Hi everyone! I've shared the latest design
                                    mockups in our project folder.
                                </div>
                                <div class="message-time">10:05 AM</div>
                            </div>

                            <!-- Message 2 -->
                            <div class="message message-self">
                                <div class="message-content">
                                    Thanks Sarah, I'll take a look at them right
                                    after the meeting.
                                </div>
                                <div class="message-time">10:07 AM</div>
                            </div>

                            <!-- Message 3 -->
                            <div class="message message-others">
                                <div class="message-header">
                                    <strong>Michael Brown</strong>
                                </div>
                                <div class="message-content">
                                    I have some feedback on the user flow.
                                    Should we discuss it now or schedule a
                                    separate meeting?
                                </div>
                                <div class="message-time">10:08 AM</div>
                            </div>

                            <!-- Message 4 -->
                            <div class="message message-others">
                                <div class="message-header">
                                    <strong>Emily Wilson</strong>
                                </div>
                                <div class="message-content">
                                    Let's discuss it briefly now and then
                                    schedule a detailed review if needed.
                                </div>
                                <div class="message-time">10:10 AM</div>
                            </div>

                            <!-- Message 5 -->
                            <div class="message message-self">
                                <div class="message-content">
                                    Sounds good. Michael, please go ahead with
                                    your feedback.
                                </div>
                                <div class="message-time">10:11 AM</div>
                            </div>
                        </div>

                        <div class="chat-input">
                            <div class="input-group">
                                <input
                                    type="text"
                                    class="form-control"
                                    placeholder="Type a message..."
                                />
                                <button class="btn btn-primary" type="button">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- People Tab -->
                    <div
                        class="tab-pane fade"
                        id="people"
                        role="tabpanel"
                        aria-labelledby="people-tab"
                    >
                        <ul class="participant-list">
                            <!-- Participant 1 (You) -->
                            <li class="participant-item">
                                <div class="participant-avatar bg-primary">
                                    JD
                                </div>
                                <div class="participant-info">
                                    <div>John Doe (You)</div>
                                    <small class="text-muted">Host</small>
                                </div>
                            </li>

                            <!-- Participant 2 -->
                            <li class="participant-item">
                                <div class="participant-avatar bg-success">
                                    SM
                                </div>
                                <div class="participant-info">
                                    <div>Sarah Miller</div>
                                    <small class="text-muted">Muted</small>
                                </div>
                                <div class="participant-actions">
                                    <button title="Direct Message">
                                        <i class="fas fa-comment"></i>
                                    </button>
                                </div>
                            </li>

                            <!-- Participant 3 -->
                            <li class="participant-item">
                                <div class="participant-avatar bg-info">MB</div>
                                <div class="participant-info">
                                    <div>Michael Brown</div>
                                    <small class="text-success">Speaking</small>
                                </div>
                                <div class="participant-actions">
                                    <button title="Direct Message">
                                        <i class="fas fa-comment"></i>
                                    </button>
                                </div>
                            </li>

                            <!-- Participant 4 -->
                            <li class="participant-item">
                                <div class="participant-avatar bg-warning">
                                    EW
                                </div>
                                <div class="participant-info">
                                    <div>Emily Wilson</div>
                                    <small class="text-muted">Muted</small>
                                </div>
                                <div class="participant-actions">
                                    <button title="Direct Message">
                                        <i class="fas fa-comment"></i>
                                    </button>
                                </div>
                            </li>

                            <!-- Participant 5 -->
                            <li class="participant-item">
                                <div class="participant-avatar bg-danger">
                                    RJ
                                </div>
                                <div class="participant-info">
                                    <div>Robert Johnson</div>
                                    <small class="text-muted">Muted</small>
                                </div>
                                <div class="participant-actions">
                                    <button title="Direct Message">
                                        <i class="fas fa-comment"></i>
                                    </button>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- Info Tab -->
                    <div
                        class="tab-pane fade"
                        id="info"
                        role="tabpanel"
                        aria-labelledby="info-tab"
                    >
                        <div class="meeting-info">
                            <h6>Meeting Details</h6>
                            <p class="small mb-3">
                                Share this meeting code with others you want to
                                invite.
                            </p>

                            <div class="meeting-code">
                                <strong>csa-weekly-123</strong>
                                <button
                                    class="copy-code"
                                    title="Copy meeting code"
                                >
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>

                            <div class="network-status mt-4">
                                <h6>Network Status</h6>
                                <div class="d-flex align-items-center">
                                    <span
                                        class="status-indicator status-good"
                                    ></span>
                                    <span>Connection strength: Good</span>
                                </div>
                                <div class="mt-2 small">
                                    <div>Upload: 2.5 Mbps</div>
                                    <div>Download: 10.2 Mbps</div>
                                    <div>Latency: 45ms</div>
                                </div>
                            </div>

                            <div class="mt-4">
                                <h6>Meeting Settings</h6>
                                <div class="form-check form-switch mb-2">
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        id="muteOnEntry"
                                        checked
                                    />
                                    <label
                                        class="form-check-label"
                                        for="muteOnEntry"
                                        >Mute participants on entry</label
                                    >
                                </div>
                                <div class="form-check form-switch mb-2">
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        id="allowRecording"
                                        checked
                                    />
                                    <label
                                        class="form-check-label"
                                        for="allowRecording"
                                        >Allow recording</label
                                    >
                                </div>
                                <div class="form-check form-switch mb-2">
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        id="waitingRoom"
                                    />
                                    <label
                                        class="form-check-label"
                                        for="waitingRoom"
                                        >Enable waiting room</label
                                    >
                                </div>
                                <div class="form-check form-switch">
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        id="lockMeeting"
                                    />
                                    <label
                                        class="form-check-label"
                                        for="lockMeeting"
                                        >Lock meeting</label
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Controls -->
    <div class="video-controls">
        <button class="control-btn btn-mute" title="Mute/Unmute">
            <i class="fas fa-microphone"></i>
        </button>
        <button class="control-btn btn-video" title="Start/Stop Video">
            <i class="fas fa-video"></i>
        </button>
        <button class="control-btn btn-screenshare" title="Share Screen">
            <i class="fas fa-desktop"></i>
        </button>
        <button class="control-btn btn-more" title="More Options">
            <i class="fas fa-ellipsis-v"></i>
        </button>
        <button class="control-btn btn-leave" title="Leave Meeting">
            <i class="fas fa-phone-slash"></i>
        </button>
    </div>
</div>
{% endblock %} {% block extra_js %}
<script src="/meeting/static/js/modules/signaling.js"></script>
<script src="/meeting/static/js/modules/media.js"></script>
<script src="/meeting/static/js/modules/call-controls.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Toggle mute button
        const muteBtn = document.querySelector(".btn-mute");
        muteBtn.addEventListener("click", function () {
            this.classList.toggle("active");
            const icon = this.querySelector("i");
            if (this.classList.contains("active")) {
                icon.classList.remove("fa-microphone");
                icon.classList.add("fa-microphone-slash");
            } else {
                icon.classList.remove("fa-microphone-slash");
                icon.classList.add("fa-microphone");
            }
        });

        // Toggle video button
        const videoBtn = document.querySelector(".btn-video");
        videoBtn.addEventListener("click", function () {
            this.classList.toggle("active");
            const icon = this.querySelector("i");
            if (this.classList.contains("active")) {
                icon.classList.remove("fa-video");
                icon.classList.add("fa-video-slash");
            } else {
                icon.classList.remove("fa-video-slash");
                icon.classList.add("fa-video");
            }
        });

        // Toggle screen share button
        const screenShareBtn = document.querySelector(".btn-screenshare");
        screenShareBtn.addEventListener("click", function () {
            this.classList.toggle("active");
        });

        // Copy meeting code button
        const copyCodeBtn = document.querySelector(".copy-code");
        copyCodeBtn.addEventListener("click", function () {
            const codeElement = document.querySelector(".meeting-code strong");
            const code = codeElement.textContent;

            navigator.clipboard.writeText(code).then(
                function () {
                    alert("Meeting code copied to clipboard!");
                },
                function (err) {
                    console.error("Could not copy text: ", err);
                }
            );
        });

        // Leave meeting button
        const leaveBtn = document.querySelector(".btn-leave");
        leaveBtn.addEventListener("click", function () {
            if (confirm("Are you sure you want to leave the meeting?")) {
                window.location.href = "/meeting";
            }
        });

        // Demo chat message sending
        const chatInput = document.querySelector(".chat-input input");
        const sendBtn = document.querySelector(".chat-input button");

        function sendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                const chatMessages = document.querySelector(".chat-messages");

                const now = new Date();
                const hours = now.getHours().toString().padStart(2, "0");
                const minutes = now.getMinutes().toString().padStart(2, "0");
                const timeString = `${hours}:${minutes} ${
                    hours >= 12 ? "PM" : "AM"
                }`;

                const messageElement = document.createElement("div");
                messageElement.className = "message message-self";
                messageElement.innerHTML = `
                    <div class="message-content">
                        ${message}
                    </div>
                    <div class="message-time">${timeString}</div>
                `;

                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                chatInput.value = "";
            }
        }

        sendBtn.addEventListener("click", sendMessage);
        chatInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                sendMessage();
            }
        });
    });
</script>
{% endblock %}
