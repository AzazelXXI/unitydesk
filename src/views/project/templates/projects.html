{% extends "core/templates/base.html" %}

{% block title %}Projects Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='/views/project/static/css/projects.css') }}">
{% endblock %}

{% block content %}
<div class="projects-container">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="page-title">
            <i class="fas fa-project-diagram text-primary me-2"></i>
            Projects Dashboard
          </h1>
          <p class="text-muted">Manage and track all your projects</p>
        </div>
        <div>
          <a href="/projects/new" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>New Project
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row mb-4">
    <div class="col-6 col-md-2 mb-3 mb-md-0">
      <div class="stats-card bg-white">
        <i class="fas fa-folder text-primary" style="font-size: 1.5rem"></i>
        <div class="stats-number">{{ stats.total }}</div>
        <div class="stats-label">Total Projects</div>
      </div>
    </div>
    <div class="col-6 col-md-2 mb-3 mb-md-0">
      <div class="stats-card bg-white">
        <i class="fas fa-clipboard-list text-secondary" style="font-size: 1.5rem"></i>
        <div class="stats-number">{{ stats.planning }}</div>
        <div class="stats-label">Planning</div>
      </div>
    </div>
    <div class="col-6 col-md-2 mb-3 mb-md-0">
      <div class="stats-card bg-white">
        <i class="fas fa-spinner text-warning" style="font-size: 1.5rem"></i>
        <div class="stats-number">{{ stats.in_progress }}</div>
        <div class="stats-label">In Progress</div>
      </div>
    </div>
    <div class="col-6 col-md-2 mb-3 mb-md-0">
      <div class="stats-card bg-white">
        <i class="fas fa-check-circle text-success" style="font-size: 1.5rem"></i>
        <div class="stats-number">{{ stats.completed }}</div>
        <div class="stats-label">Completed</div>
      </div>
    </div>
    <div class="col-6 col-md-2 mb-3 mb-md-0">
      <div class="stats-card bg-white">
        <i class="fas fa-dollar-sign text-info" style="font-size: 1.5rem"></i>
        <div class="stats-number">${{ "{:,.0f}".format(stats.total_budget) }}</div>
        <div class="stats-label">Total Budget</div>
      </div>
    </div>
    <div class="col-6 col-md-2 mb-3 mb-md-0">
      <div class="stats-card bg-white">
        <i class="fas fa-chart-line text-purple" style="font-size: 1.5rem"></i>
        <div class="stats-number">{{ stats.avg_progress }}%</div>
        <div class="stats-label">Avg Progress</div>
      </div>
    </div>  </div>

  <!-- Projects Grid -->
  <div class="row">
    {% if projects %}
      {% for project in projects %}
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="project-card">
            <div class="project-header">
              <div class="d-flex justify-content-between align-items-start">
                <h5 class="project-title">
                  <a href="/projects/{{ project.id }}" class="text-decoration-none">
                    {{ project.name }}
                  </a>
                </h5>
                <span class="badge project-status status-{{ project.status.lower().replace(' ', '-') }}">
                  {{ project.status }}
                </span>
              </div>
              <p class="project-description text-muted">
                {{ project.description[:100] }}{% if project.description|length > 100 %}...{% endif %}
              </p>
            </div>
            
            <div class="project-body">
              <!-- Progress Bar -->
              <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <small class="text-muted">Progress</small>
                  <small class="text-muted">{{ project.progress }}%</small>
                </div>
                <div class="progress" style="height: 6px;">
                  <div class="progress-bar" role="progressbar" 
                       style="width: {{ project.progress }}%" 
                       aria-valuenow="{{ project.progress }}" 
                       aria-valuemin="0" 
                       aria-valuemax="100">
                  </div>
                </div>
              </div>

              <!-- Project Info -->
              <div class="row text-center">
                <div class="col-4">
                  <div class="project-stat">
                    <div class="stat-number">{{ project.task_count }}</div>
                    <div class="stat-label">Tasks</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="project-stat">
                    <div class="stat-number">{{ project.completed_tasks }}</div>
                    <div class="stat-label">Done</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="project-stat">
                    <div class="stat-number">${{ "{:,.0f}".format(project.budget) }}</div>
                    <div class="stat-label">Budget</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="project-footer">
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">
                  {% if project.start_date %}
                    Started: {{ project.start_date.strftime('%m/%d/%y') }}
                  {% else %}
                    Not started
                  {% endif %}
                </small>
                <div class="project-actions">
                  <a href="/projects/{{ project.id }}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a href="/projects/{{ project.id }}/edit" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-edit"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="col-12">
        <div class="empty-state text-center py-5">
          <i class="fas fa-folder-open text-muted" style="font-size: 4rem; opacity: 0.3;"></i>
          <h3 class="mt-3 text-muted">No Projects Found</h3>
          <p class="text-muted">Get started by creating your first project</p>
          <a href="/projects/new" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Create Your First Project
          </a>
        </div>
      </div>
    {% endif %}
  </div>

  {% if error %}
    <div class="alert alert-warning" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ error }}
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', path='/views/project/static/js/projects.js') }}"></script>
{% endblock %}
        margin-bottom: 1rem;
    }
    
    .project-card .project-progress {
        margin-bottom: 0.75rem;
    }
    
    .project-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1rem;
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    .project-team {
        display: flex;
        align-items: center;
    }
    
    .project-team .avatar-group {
        display: flex;
        margin-right: 0.5rem;
    }
    
    .project-team .avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background-color: #4e73df;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.7rem;
        border: 2px solid #fff;
        margin-left: -8px;
    }
    
    .project-team .avatar:first-child {
        margin-left: 0;
    }
    
    .project-progress-bar {
        height: 8px;
        border-radius: 4px;
    }
    
    .project-progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.25rem;
        font-size: 0.875rem;
    }
    
    .project-deadline {
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
    }
    
    .project-deadline i {
        margin-right: 0.25rem;
        font-size: 0.875rem;
    }
    
    .project-deadline.overdue {
        color: #e74a3b;
    }
    
    .project-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .badge-active {
        background-color: rgba(28, 200, 138, 0.1);
        color: #1cc88a;
    }
    
    .badge-pending {
        background-color: rgba(246, 194, 62, 0.1);
        color: #f6c23e;
    }
    
    .badge-completed {
        background-color: rgba(78, 115, 223, 0.1);
        color: #4e73df;
    }
    
    .badge-canceled {
        background-color: rgba(231, 74, 59, 0.1);
        color: #e74a3b;
    }
    
    .new-project-card {
        border-radius: 0.5rem;
        border: 2px dashed #d1d3e2;
        background-color: transparent;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        height: 100%;
        min-height: 250px;
    }
    
    .new-project-card:hover {
        border-color: #4e73df;
        background-color: rgba(78, 115, 223, 0.05);
    }
    
    .new-project-card .new-project-icon {
        font-size: 2.5rem;
        color: #4e73df;
        margin-bottom: 1rem;
    }
    
    .project-filters {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .filter-tabs .nav-link {
        color: #6c757d;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border: none;
    }
    
    .filter-tabs .nav-link.active {
        color: #4e73df;
        background-color: transparent;
        border-bottom: 2px solid #4e73df;
    }
    
    .filter-options {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .gantt-chart {
        margin-top: 2rem;
        overflow-x: auto;
    }
    
    .gantt-container {
        min-width: 1000px;
    }
    
    .gantt-header {
        display: flex;
    }
    
    .gantt-task-info {
        width: 250px;
        padding: 0.75rem;
        font-weight: 600;
        border-bottom: 1px solid #e3e6f0;
    }
    
    .gantt-timeline {
        display: flex;
        flex: 1;
    }
    
    .gantt-day {
        flex: 1;
        text-align: center;
        padding: 0.75rem 0;
        font-size: 0.75rem;
        border-bottom: 1px solid #e3e6f0;
    }
    
    .gantt-row {
        display: flex;
        height: 50px;
        border-bottom: 1px solid #f8f9fc;
    }
    
    .gantt-task-name {
        width: 250px;
        padding: 0.75rem;
        display: flex;
        align-items: center;
        background-color: #f8f9fc;
    }
    
    .gantt-task-bars {
        position: relative;
        flex: 1;
        display: flex;
    }
    
    .gantt-day-column {
        flex: 1;
        border-right: 1px solid #f8f9fc;
    }
    
    .gantt-day-column:last-child {
        border-right: none;
    }
    
    .gantt-bar {
        position: absolute;
        height: 20px;
        top: 15px;
        border-radius: 4px;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .gantt-bar-milestone {
        height: 20px;
        width: 20px;
        border-radius: 50%;
        top: 15px;
        position: absolute;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .project-meta {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .project-team {
            margin-bottom: 1rem;
        }
        
        .filter-tabs .nav-link {
            padding: 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Page Header -->
    <div class="project-header d-sm-flex align-items-center justify-content-between mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800"><i class="fas fa-project-diagram me-2"></i>Projects</h1>
            <p class="text-muted mb-0">Manage and track all your projects in one place</p>
        </div>
        <div>
            <button class="btn btn-sm btn-outline-secondary me-2">
                <i class="fas fa-filter me-1"></i> Filter
            </button>
            <button class="btn btn-sm btn-primary shadow-sm" data-bs-toggle="modal" data-bs-target="#newProjectModal">
                <i class="fas fa-plus fa-sm me-1"></i> New Project
            </button>
        </div>
    </div>

    <!-- Project Stats -->
    <div class="row project-stats">
        <div class="col-xl-3 col-md-6">
            <div class="card stat-card border-left-primary">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col me-2">
                            <div class="stat-label text-uppercase mb-1">Total Projects</div>
                            <div class="stat-value">42</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up me-1"></i> 12% from last month
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-project-diagram stat-icon text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card stat-card border-left-success">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col me-2">
                            <div class="stat-label text-uppercase mb-1">Completed</div>
                            <div class="stat-value">18</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up me-1"></i> 5% from last month
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-check-circle stat-icon text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card stat-card border-left-info">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col me-2">
                            <div class="stat-label text-uppercase mb-1">In Progress</div>
                            <div class="stat-value">24</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up me-1"></i> 8% from last month
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-spinner stat-icon text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card stat-card border-left-warning">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col me-2">
                            <div class="stat-label text-uppercase mb-1">Behind Schedule</div>
                            <div class="stat-value">7</div>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-arrow-down me-1"></i> 3% from last month
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-exclamation-triangle stat-icon text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Filters -->
    <div class="project-filters">
        <ul class="nav nav-pills filter-tabs">
            <li class="nav-item">
                <a class="nav-link active" href="#">All Projects</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Active</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Completed</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Archived</a>
            </li>
        </ul>
        <div class="filter-options">
            <div class="input-group">
                <input type="text" class="form-control form-control-sm" placeholder="Search projects...">
                <button class="btn btn-primary btn-sm" type="button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="dropdown">
                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-sort me-1"></i> Sort
                </button>
                <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                    <li><a class="dropdown-item" href="#"><i class="fas fa-calendar-alt me-2"></i> Date Created</a></li>
                    <li><a class="dropdown-item" href="#"><i class="fas fa-calendar-check me-2"></i> Due Date</a></li>
                    <li><a class="dropdown-item" href="#"><i class="fas fa-sort-alpha-down me-2"></i> Name</a></li>
                    <li><a class="dropdown-item" href="#"><i class="fas fa-chart-line me-2"></i> Progress</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Project List -->
    <div class="row project-list">
        <!-- Project Card 1 -->
        <div class="col-lg-6 col-xl-4">
            <div class="card project-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="project-badge badge-active">Active</span>
                        <div class="dropdown">
                            <button class="btn btn-link btn-sm p-0 text-muted" type="button" id="project1Actions" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="project1Actions">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-eye me-2"></i> View Details</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i> Edit Project</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-chart-bar me-2"></i> View Analytics</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-archive me-2"></i> Archive</a></li>
                                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash-alt me-2"></i> Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    <h5 class="card-title">Website Redesign</h5>
                    <p class="card-text">Complete overhaul of company website with new design system and improved user experience.</p>
                    <div class="project-progress">
                        <div class="project-progress-label">
                            <span>Progress</span>
                            <span>75%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-primary project-progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="project-deadline">
                        <i class="far fa-calendar-alt"></i> Due in 2 weeks
                    </div>
                    <div class="project-meta mt-3">
                        <div class="project-team">
                            <div class="avatar-group">
                                <div class="avatar">JD</div>
                                <div class="avatar">SM</div>
                                <div class="avatar">MB</div>
                                <div class="avatar">+2</div>
                            </div>
                        </div>
                        <div>
                            <i class="fas fa-tasks me-1"></i> 24/32 tasks
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Card 2 -->
        <div class="col-lg-6 col-xl-4">
            <div class="card project-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="project-badge badge-active">Active</span>
                        <div class="dropdown">
                            <button class="btn btn-link btn-sm p-0 text-muted" type="button" id="project2Actions" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="project2Actions">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-eye me-2"></i> View Details</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i> Edit Project</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-chart-bar me-2"></i> View Analytics</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-archive me-2"></i> Archive</a></li>
                                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash-alt me-2"></i> Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    <h5 class="card-title">Mobile App Development</h5>
                    <p class="card-text">Create a companion mobile app for our product with offline capabilities and push notifications.</p>
                    <div class="project-progress">
                        <div class="project-progress-label">
                            <span>Progress</span>
                            <span>85%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-success project-progress-bar" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="project-deadline">
                        <i class="far fa-calendar-alt"></i> Due in 1 week
                    </div>
                    <div class="project-meta mt-3">
                        <div class="project-team">
                            <div class="avatar-group">
                                <div class="avatar">RJ</div>
                                <div class="avatar">EW</div>
                                <div class="avatar">MB</div>
                            </div>
                        </div>
                        <div>
                            <i class="fas fa-tasks me-1"></i> 18/22 tasks
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Card 3 -->
        <div class="col-lg-6 col-xl-4">
            <div class="card project-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="project-badge badge-active">Active</span>
                        <div class="dropdown">
                            <button class="btn btn-link btn-sm p-0 text-muted" type="button" id="project3Actions" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="project3Actions">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-eye me-2"></i> View Details</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i> Edit Project</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-chart-bar me-2"></i> View Analytics</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-archive me-2"></i> Archive</a></li>
                                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash-alt me-2"></i> Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    <h5 class="card-title">CRM Implementation</h5>
                    <p class="card-text">Implement and customize a new CRM system to improve customer relationship management and sales tracking.</p>
                    <div class="project-progress">
                        <div class="project-progress-label">
                            <span>Progress</span>
                            <span>45%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-info project-progress-bar" role="progressbar" style="width: 45%" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="project-deadline overdue">
                        <i class="far fa-calendar-alt"></i> Due in 3 weeks
                    </div>
                    <div class="project-meta mt-3">
                        <div class="project-team">
                            <div class="avatar-group">
                                <div class="avatar">SM</div>
                                <div class="avatar">EW</div>
                                <div class="avatar">+1</div>
                            </div>
                        </div>
                        <div>
                            <i class="fas fa-tasks me-1"></i> 12/28 tasks
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Card 4 -->
        <div class="col-lg-6 col-xl-4">
            <div class="card project-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="project-badge badge-warning">Behind Schedule</span>
                        <div class="dropdown">
                            <button class="btn btn-link btn-sm p-0 text-muted" type="button" id="project4Actions" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="project4Actions">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-eye me-2"></i> View Details</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i> Edit Project</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-chart-bar me-2"></i> View Analytics</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-archive me-2"></i> Archive</a></li>
                                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash-alt me-2"></i> Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    <h5 class="card-title">Marketing Campaign</h5>
                    <p class="card-text">Plan and execute a multi-channel marketing campaign for the new product launch.</p>
                    <div class="project-progress">
                        <div class="project-progress-label">
                            <span>Progress</span>
                            <span>30%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-warning project-progress-bar" role="progressbar" style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="project-deadline overdue">
                        <i class="far fa-calendar-alt"></i> Due in 1 week (overdue)
                    </div>
                    <div class="project-meta mt-3">
                        <div class="project-team">
                            <div class="avatar-group">
                                <div class="avatar">JD</div>
                                <div class="avatar">RJ</div>
                            </div>
                        </div>
                        <div>
                            <i class="fas fa-tasks me-1"></i> 8/26 tasks
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Card 5 -->
        <div class="col-lg-6 col-xl-4">
            <div class="card project-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="project-badge badge-pending">Pending</span>
                        <div class="dropdown">
                            <button class="btn btn-link btn-sm p-0 text-muted" type="button" id="project5Actions" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="project5Actions">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-eye me-2"></i> View Details</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i> Edit Project</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-chart-bar me-2"></i> View Analytics</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-archive me-2"></i> Archive</a></li>
                                <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash-alt me-2"></i> Delete</a></li>
                            </ul>
                        </div>
                    </div>
                    <h5 class="card-title">Database Migration</h5>
                    <p class="card-text">Migrate the existing database to a cloud-based solution with improved performance and security.</p>
                    <div class="project-progress">
                        <div class="project-progress-label">
                            <span>Progress</span>
                            <span>15%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-danger project-progress-bar" role="progressbar" style="width: 15%" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="project-deadline">
                        <i class="far fa-calendar-alt"></i> Due in 2 months
                    </div>
                    <div class="project-meta mt-3">
                        <div class="project-team">
                            <div class="avatar-group">
                                <div class="avatar">MB</div>
                                <div class="avatar">SM</div>
                            </div>
                        </div>
                        <div>
                            <i class="fas fa-tasks me-1"></i> 3/20 tasks
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Project Card -->
        <div class="col-lg-6 col-xl-4">
            <div class="new-project-card" data-bs-toggle="modal" data-bs-target="#newProjectModal">
                <div class="new-project-icon">
                    <i class="fas fa-plus-circle"></i>
                </div>
                <h5>Create New Project</h5>
                <p class="text-muted">Add a new project to your workspace</p>
            </div>
        </div>
    </div>

    <!-- Timeline Section -->
    <h4 class="mb-4">Project Timeline</h4>
    <div class="gantt-chart">
        <div class="gantt-container">
            <div class="gantt-header">
                <div class="gantt-task-info">Project</div>
                <div class="gantt-timeline">
                    <!-- Generate days for current month -->
                    <div class="gantt-day">May 1</div>
                    <div class="gantt-day">May 2</div>
                    <div class="gantt-day">May 3</div>
                    <div class="gantt-day">May 4</div>
                    <div class="gantt-day">May 5</div>
                    <div class="gantt-day">May 6</div>
                    <div class="gantt-day">May 7</div>
                    <div class="gantt-day">May 8</div>
                    <div class="gantt-day">May 9</div>
                    <div class="gantt-day">May 10</div>
                    <div class="gantt-day">May 11</div>
                    <div class="gantt-day">May 12</div>
                    <div class="gantt-day">May 13</div>
                    <div class="gantt-day">May 14</div>
                </div>
            </div>
            
            <!-- Project 1 in timeline -->
            <div class="gantt-row">
                <div class="gantt-task-name">Website Redesign</div>
                <div class="gantt-task-bars">
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-bar" style="left: 0%; width: 65%; background-color: #4e73df;">
                        75%
                    </div>
                    <div class="gantt-bar-milestone" style="left: calc(65% - 10px); background-color: #e74a3b;"></div>
                </div>
            </div>
            
            <!-- Project 2 in timeline -->
            <div class="gantt-row">
                <div class="gantt-task-name">Mobile App Development</div>
                <div class="gantt-task-bars">
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-bar" style="left: 15%; width: 42%; background-color: #1cc88a;">
                        85%
                    </div>
                    <div class="gantt-bar-milestone" style="left: calc(57% - 10px); background-color: #f6c23e;"></div>
                </div>
            </div>
            
            <!-- Project 3 in timeline -->
            <div class="gantt-row">
                <div class="gantt-task-name">CRM Implementation</div>
                <div class="gantt-task-bars">
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-bar" style="left: 30%; width: 70%; background-color: #36b9cc;">
                        45%
                    </div>
                    <div class="gantt-bar-milestone" style="left: calc(100% - 10px); background-color: #1cc88a;"></div>
                </div>
            </div>
            
            <!-- Project 4 in timeline -->
            <div class="gantt-row">
                <div class="gantt-task-name">Marketing Campaign</div>
                <div class="gantt-task-bars">
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-bar" style="left: 5%; width: 30%; background-color: #f6c23e;">
                        30%
                    </div>
                    <div class="gantt-bar-milestone" style="left: calc(35% - 10px); background-color: #e74a3b;"></div>
                </div>
            </div>
            
            <!-- Project 5 in timeline -->
            <div class="gantt-row">
                <div class="gantt-task-name">Database Migration</div>
                <div class="gantt-task-bars">
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-day-column"></div>
                    <div class="gantt-bar" style="left: 50%; width: 15%; background-color: #e74a3b;">
                        15%
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Project Modal -->
<div class="modal fade" id="newProjectModal" tabindex="-1" aria-labelledby="newProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="newProjectModalLabel"><i class="fas fa-plus-circle me-2"></i>Create New Project</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newProjectForm">
                    <div class="mb-3">
                        <label for="projectTitle" class="form-label">Project Title</label>
                        <input type="text" class="form-control" id="projectTitle" placeholder="Enter project title" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="projectDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="projectDescription" rows="3" placeholder="Describe the project objectives and scope"></textarea>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="projectType" class="form-label">Project Type</label>
                            <select class="form-select" id="projectType" required>
                                <option value="">Select type</option>
                                <option value="web">Web Development</option>
                                <option value="mobile">Mobile Development</option>
                                <option value="design">Design</option>
                                <option value="marketing">Marketing</option>
                                <option value="internal">Internal</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="projectPriority" class="form-label">Priority</label>
                            <select class="form-select" id="projectPriority" required>
                                <option value="">Select priority</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                        <div class="col-md-6">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="endDate" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="projectManager" class="form-label">Project Manager</label>
                        <select class="form-select" id="projectManager" required>
                            <option value="">Select project manager</option>
                            <option value="1">John Doe</option>
                            <option value="2">Sarah Miller</option>
                            <option value="3">Michael Brown</option>
                            <option value="4">Emily Wilson</option>
                            <option value="5">Robert Johnson</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="projectTeam" class="form-label">Team Members</label>
                        <select class="form-select" id="projectTeam" multiple>
                            <option value="1">John Doe</option>
                            <option value="2">Sarah Miller</option>
                            <option value="3">Michael Brown</option>
                            <option value="4">Emily Wilson</option>
                            <option value="5">Robert Johnson</option>
                            <option value="6">David Lee</option>
                            <option value="7">Amanda Martinez</option>
                            <option value="8">Brian Taylor</option>
                        </select>
                        <div class="form-text">Hold Ctrl (or Cmd) to select multiple members</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="projectBudget" class="form-label">Budget</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="projectBudget" placeholder="Enter budget amount">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="projectTags" class="form-label">Tags</label>
                        <input type="text" class="form-control" id="projectTags" placeholder="Enter tags separated by commas">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="createProjectBtn">Create Project</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle filter tabs
        const filterTabs = document.querySelectorAll('.filter-tabs .nav-link');
        
        filterTabs.forEach(tab => {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all tabs
                filterTabs.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Filter projects based on selected tab
                const filter = this.textContent.trim().toLowerCase();
                filterProjects(filter);
            });
        });
        
        // Function to filter projects
        function filterProjects(filter) {
            const projectCards = document.querySelectorAll('.project-card');
            
            projectCards.forEach(card => {
                const status = card.querySelector('.project-badge').textContent.toLowerCase();
                
                if (filter === 'all projects' || status.includes(filter)) {
                    card.closest('.col-lg-6').style.display = 'block';
                } else {
                    card.closest('.col-lg-6').style.display = 'none';
                }
            });
            
            console.log(`Filtering projects by: ${filter}`);
        }
        
        // Handle search functionality
        const searchInput = document.querySelector('.filter-options input');
        
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            
            if (searchTerm.length < 2) {
                // Reset filter if search term is too short
                const activeTab = document.querySelector('.filter-tabs .nav-link.active');
                filterProjects(activeTab.textContent.trim().toLowerCase());
                return;
            }
            
            // Search projects by title and description
            const projectCards = document.querySelectorAll('.project-card');
            
            projectCards.forEach(card => {
                const title = card.querySelector('.card-title').textContent.toLowerCase();
                const description = card.querySelector('.card-text').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || description.includes(searchTerm)) {
                    card.closest('.col-lg-6').style.display = 'block';
                } else {
                    card.closest('.col-lg-6').style.display = 'none';
                }
            });
        });
        
        // Handle create project button
        document.getElementById('createProjectBtn').addEventListener('click', function() {
            const form = document.getElementById('newProjectForm');
            
            // Basic form validation
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Get form values
            const title = document.getElementById('projectTitle').value;
            const description = document.getElementById('projectDescription').value;
            const type = document.getElementById('projectType').value;
            const priority = document.getElementById('projectPriority').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const manager = document.getElementById('projectManager').value;
            const team = Array.from(document.getElementById('projectTeam').selectedOptions).map(option => option.value);
            const budget = document.getElementById('projectBudget').value;
            const tags = document.getElementById('projectTags').value;
            
            // In a real application, you would call an API to create the project
            console.log('Creating new project:');
            console.log('Title:', title);
            console.log('Description:', description);
            console.log('Type:', type);
            console.log('Priority:', priority);
            console.log('Start Date:', startDate);
            console.log('End Date:', endDate);
            console.log('Manager:', manager);
            console.log('Team:', team);
            console.log('Budget:', budget);
            console.log('Tags:', tags);
            
            // Add the new project to the project list
            addNewProjectToList({
                title: title,
                description: description,
                progress: 0,
                dueDate: endDate,
                team: team
            });
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('newProjectModal'));
            modal.hide();
            
            // Show success message
            CSA.showToast('Project Created', 'The project has been successfully created', 'success');
        });
        
        // Function to add a new project to the list
        function addNewProjectToList(project) {
            const projectList = document.querySelector('.project-list');
            const newProjectCard = document.querySelector('.new-project-card').closest('.col-lg-6');
            
            // Create new project card element
            const projectCardCol = document.createElement('div');
            projectCardCol.className = 'col-lg-6 col-xl-4';
            
            const dueDate = new Date(project.dueDate);
            const now = new Date();
            const diffTime = dueDate.getTime() - now.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 3600 * 24));
            
            const dueDateText = diffDays > 30 
                ? `Due in ${Math.floor(diffDays / 30)} months` 
                : diffDays > 7 
                    ? `Due in ${Math.floor(diffDays / 7)} weeks` 
                    : `Due in ${diffDays} days`;
            
            projectCardCol.innerHTML = `
                <div class="card project-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="project-badge badge-active">Active</span>
                            <div class="dropdown">
                                <button class="btn btn-link btn-sm p-0 text-muted" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-eye me-2"></i> View Details</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i> Edit Project</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-chart-bar me-2"></i> View Analytics</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-archive me-2"></i> Archive</a></li>
                                    <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash-alt me-2"></i> Delete</a></li>
                                </ul>
                            </div>
                        </div>
                        <h5 class="card-title">${project.title}</h5>
                        <p class="card-text">${project.description}</p>
                        <div class="project-progress">
                            <div class="project-progress-label">
                                <span>Progress</span>
                                <span>${project.progress}%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar bg-primary project-progress-bar" role="progressbar" style="width: ${project.progress}%" aria-valuenow="${project.progress}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        <div class="project-deadline">
                            <i class="far fa-calendar-alt"></i> ${dueDateText}
                        </div>
                        <div class="project-meta mt-3">
                            <div class="project-team">
                                <div class="avatar-group">
                                    <div class="avatar">JD</div>
                                </div>
                            </div>
                            <div>
                                <i class="fas fa-tasks me-1"></i> 0/0 tasks
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Insert the new project card before the "Create New Project" card
            projectList.insertBefore(projectCardCol, newProjectCard);
            
            // Update stats
            updateProjectStats();
        }
        
        // Function to update project statistics
        function updateProjectStats() {
            const totalProjects = document.querySelectorAll('.project-card').length;
            const activeProjects = document.querySelectorAll('.project-badge.badge-active').length;
            const completedProjects = document.querySelectorAll('.project-badge.badge-completed').length;
            const behindSchedule = document.querySelectorAll('.project-badge.badge-warning').length;
            
            // Update stat cards
            document.querySelector('.stat-card:nth-child(1) .stat-value').textContent = totalProjects;
            document.querySelector('.stat-card:nth-child(2) .stat-value').textContent = completedProjects;
            document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = activeProjects;
            document.querySelector('.stat-card:nth-child(4) .stat-value').textContent = behindSchedule;
        }
    });
</script>
{% endblock %}
