**Infrastructure

I. Kiến trúc Hệ thống (System Architecture)

* Kiến trúc Monolithic với Module Hóa: Thay vì sử dụng kiến trúc Microservices phức tạp, chúng ta sẽ sử dụng kiến trúc Monolithic có module hóa để dễ dàng triển khai trên một máy chủ Windows 10/11.

  * Ưu điểm: Đơn giản hóa việc triển khai và quản lý, giảm overhead, dễ dàng debug và phát triển trên môi trường Windows, phù hợp cho quy mô 30 người dùng đồng thời.
  * Thiết kế Module: Hệ thống được chia thành các module chức năng rõ ràng theo yêu cầu từ brief, bao gồm:
    * Giao tiếp (Messenger)
    * Lịch (Calendar)
    * Tài liệu (Docs)
    * Lưu trữ Đám Mây (Cloud Drive)
    * Email Tích Hợp
    * Quản lý Công Việc & Dự Án (Tasks/Projects)
    * Quy trình & Phê duyệt (Approval)
    * Hội nghị Trực tuyến (Video Conference)
    * Quản trị Hệ thống (Admin Console)
    * Nền tảng Mở (Open Platform)

* API Gateway Tích hợp: API Gateway được tích hợp trực tiếp vào ứng dụng FastAPI thay vì là một dịch vụ riêng biệt.
  * Chức năng: Định tuyến (routing) request đến các module phù hợp, xác thực và ủy quyền (authentication & authorization), giới hạn tần suất truy cập (rate limiting), logging tập trung.
  * Công nghệ gợi ý: FastAPI Router, FastAPI Security, FastAPI Middleware.

* Giao tiếp bất đồng bộ (Asynchronous Communication):
  * Sử dụng hệ thống giao tiếp bất đồng bộ nhẹ, tích hợp trực tiếp với FastAPI.
  * Công nghệ gợi ý: Celery với Redis làm message broker, hoặc APScheduler cho các tác vụ định kỳ và không cần real-time.

II. Công nghệ Frontend (Client-side)

1. Web Application:
   * Framework/Library: React với TypeScript (Hiện đại, hiệu năng tốt, cộng đồng lớn).
   * Quản lý State: Zustand (nhỏ gọn, hiệu năng cao, dễ học) hoặc Redux Toolkit.
   * Build Tool: Vite (nhanh, hiện đại, ít tài nguyên).
   * UI Library: Chakra UI hoặc Ant Design (Giao diện đẹp, responsive, nhiều component sẵn có).
   * Real-time: WebSocket thông qua thư viện Socket.IO client.
   * Internationalization: React-i18next để hỗ trợ đa ngôn ngữ (tối thiểu Tiếng Việt và Tiếng Anh).

2. Mobile Applications (iOS & Android):
   * Cross-Platform: Flutter (hiệu suất gần với native, cộng đồng lớn, UI đẹp) hoặc React Native (tận dụng codebase React).
   * Thư viện HTTP Client: Dio (Flutter) hoặc Axios (React Native).
   * State Management: Provider/Riverpod (Flutter) hoặc Zustand (React Native).
   * Push Notifications: Firebase Cloud Messaging (FCM) cho cả iOS và Android.

3. Desktop Applications (Windows, macOS):
   * Framework: Tauri (sử dụng WebView, hiệu suất tốt hơn Electron, nhẹ hơn, sử dụng ít tài nguyên hơn).
   * Tích hợp: Tauri cho phép sử dụng lại frontend web React.
   * Tính năng Desktop: Thông báo hệ thống, tray icon, khởi động cùng hệ thống.

III. Công nghệ Backend (Server-side)

* Ngôn ngữ & Framework:
  * Python 3.9+ với FastAPI: Framework hiện đại, hiệu năng cao, hỗ trợ async/await, tự động tạo API docs, validation dựa trên Pydantic.
  * Uvicorn/Hypercorn: ASGI server để chạy FastAPI, hỗ trợ WebSockets.
  * SQLAlchemy: ORM để làm việc với database SQL.
  * Alembic: Database migration.

* Cấu trúc Project (Chia theo tất cả các module nêu trong brief):
  * Auth: Quản lý xác thực và phân quyền người dùng.
  * Messenger: Module giao tiếp và nhắn tin.
  * Calendar: Quản lý lịch và sự kiện.
  * Docs: Hệ thống quản lý và cộng tác tài liệu.
  * Drive: Lưu trữ đám mây và quản lý file.
  * Email: Tích hợp và quản lý email.
  * Tasks: Quản lý công việc và dự án.
  * Approval: Quy trình và phê duyệt.
  * Video: Hội nghị trực tuyến và video call.
  * Admin: Bảng điều khiển quản trị.
  * Platform: API và SDK cho nền tảng mở.
  * Shared: Thư viện và tiện ích dùng chung.

* Giao tiếp Thời gian thực:
  * WebSockets: Tích hợp trực tiếp thông qua FastAPI WebSockets.
  * Broadcast Library: FastAPI WebSockets với Broadcast (từ "broadcaster" package) để quản lý WebSocket connections.
  * PubSub với Redis: Để hỗ trợ real-time notifications và updates giữa các module.

* Hội nghị Trực tuyến (Video Conferencing):
  * WebRTC: Sử dụng mô hình P2P cho cuộc gọi 1-1.
  * Signaling Server: FastAPI WebSockets cho signaling.
  * STUN Server: Sử dụng dịch vụ STUN miễn phí hoặc Google STUN servers.
  * SFU cho cuộc họp nhiều người: MediaSoup hoặc LiveKit (phiên bản đơn giản cho quy mô nhỏ).
  * API cho quản lý phòng họp, người tham gia, và quyền trong cuộc họp.

* Cộng tác Tài liệu Thời gian thực:
  * Yjs: Thư viện CRDT (Conflict-free Replicated Data Types) hiệu quả cho real-time collaboration.
  * ProseMirror: Để xây dựng rich-text editor cho tài liệu văn bản.
  * Đồng bộ qua WebSockets trong FastAPI.
  * Versioning System: Lưu trữ và quản lý phiên bản tài liệu.

* Email Tích hợp:
  * SMTP/IMAP Client: Để kết nối và quản lý email.
  * Email Parser và Composer: Xử lý và tạo email với định dạng phong phú.
  * Email Threading: Nhóm các email theo chủ đề.

IV. Cơ sở dữ liệu & Lưu trữ (Databases & Storage)

* Cơ sở dữ liệu Chính:
  * SQLite: Nhẹ, không cần cài đặt server riêng, đủ cho 30 người dùng đồng thời. Dễ dàng chuyển sang PostgreSQL khi cần mở rộng.
  * Phân chia Schema: Tạo các schema riêng cho từng module lớn để dễ quản lý.
  * Lưu ý: Đảm bảo sao lưu thường xuyên và optimize query để đảm bảo hiệu năng.

* Cache & Session Management:
  * Redis: Nhẹ, dễ cài đặt trên Windows, dùng cho cache, session, pub/sub cho real-time features.
  * Thay thế: Nếu không thể cài đặt Redis, có thể dùng FastAPI với SessionMiddleware và FileSystemCache.

* Lưu trữ Tệp tin:
  * Local File System: Kết hợp với FastAPI File Upload/Download APIs.
  * Tổ chức directory theo user/group ID với phân quyền rõ ràng.
  * Versioning cho tài liệu: Lưu trữ các phiên bản tài liệu để có thể khôi phục.
  * (Tùy chọn) Minio: Object storage có thể triển khai tại chỗ, API tương thích với S3.

* Tìm kiếm & Indexing:
  * SQLite FTS5 (Full-Text Search): Cho phép tìm kiếm toàn văn bản hiệu quả.
  * (Tùy chọn) Whoosh hoặc ElasticSearch nhẹ: Cho tìm kiếm nâng cao nếu cần.

V. Hạ tầng & Triển khai (Infrastructure & Deployment)

* Máy chủ vật lý:
  * Hệ điều hành: Windows 10/11 Pro/Enterprise.
  * Yêu cầu khuyến nghị: CPU 4+ cores, RAM 16GB+, SSD 512GB+.
  * Kết nối mạng: Ổn định, tốc độ upload tối thiểu 50Mbps, IP tĩnh hoặc DDNS.

* Triển khai Ứng dụng:
  * Python 3.9+ với venv để quản lý dependencies.
  * Cài đặt các dependencies: FastAPI, Uvicorn, SQLAlchemy, Redis, v.v.
  * Windows Service (với NSSM): Đảm bảo ứng dụng tự khởi động cùng hệ thống.
  * Reverse Proxy: NGINX trên Windows hoặc Caddy (dễ cài đặt) để quản lý SSL và load balancing ban đầu.

* CI/CD:
  * GitHub Actions hoặc GitLab CI/CD: Tự động kiểm tra code, build và triển khai.
  * Deployment Script: PowerShell script đơn giản để update và restart service.

* Giám sát & Logging:
  * Logging tích hợp: Python logging + rotating file handler.
  * Đơn giản hóa: Sentry (theo dõi lỗi), Prometheus + Grafana (cho metrics).
  * Alerting: Email hoặc webhook notifications khi có sự cố.
  * Dashboard Admin: Hiển thị thông tin về hiệu suất hệ thống và hoạt động người dùng.

* Network & Security:
  * Reverse Proxy với SSL Termination: NGINX/Caddy với Let's Encrypt.
  * Mạng nội bộ: NAT + Port Forwarding (80, 443) đến server.
  * Firewall Windows: Cấu hình để chỉ mở các cổng cần thiết.
  * DDNS (Dynamic DNS): Để dễ dàng truy cập từ internet nếu không có IP tĩnh.

VI. Bảo mật (Security)

* Xác thực (Authentication):
  * JWT (JSON Web Tokens) với FastAPI Security.
  * OAuth2 cơ bản (Google, Microsoft) nếu cần.
  * MFA (Multi-Factor Authentication) với TOTP (Time-based One-Time Password).
  * Session Management: Theo dõi và quản lý phiên đăng nhập trên các thiết bị.

* Ủy quyền (Authorization):
  * RBAC (Role-Based Access Control) tích hợp trong FastAPI.
  * Casbin: Thư viện nhẹ quản lý phân quyền chi tiết theo vai trò, đối tượng và hành động.
  * Phân quyền chi tiết cho từng module và tính năng như mô tả trong Admin Console.

* Bảo mật API:
  * HTTPS bắt buộc (qua Reverse Proxy).
  * Rate Limiting với FastAPI middleware hoặc NGINX.
  * Input Validation: Pydantic models của FastAPI.
  * API Key cho tích hợp với các dịch vụ bên ngoài và Open Platform.

* Mã hóa Dữ liệu:
  * HTTPS cho dữ liệu đang truyền.
  * Mật khẩu: Hashed với Bcrypt.
  * Dữ liệu nhạy cảm: Mã hóa với Fernet (symmetric encryption) từ Python cryptography.
  * File Encryption: Mã hóa tệp tin nhạy cảm khi lưu trữ.

* Quản lý và Giám sát Bảo mật:
  * Audit Logging: Ghi lại tất cả các hoạt động quan trọng cho mục đích kiểm toán.
  * Quản lý Phiên đăng nhập: Xem và quản lý các phiên đăng nhập trên nhiều thiết bị.
  * Chính sách Mật khẩu: Cấu hình yêu cầu độ phức tạp và thời gian hết hạn mật khẩu.
  * IP Access Control: Hạn chế truy cập theo địa chỉ IP nếu cần thiết.

VII. Modules Chi tiết & Tính năng đặc biệt

* Module Giao tiếp (Messenger):
  * Real-time Chat: Sử dụng WebSockets để gửi/nhận tin nhắn ngay lập tức.
  * Trạng thái Người dùng: Hiển thị online/offline/đang gõ.
  * Thông báo: Đẩy thông báo cho tin nhắn mới, @mentions.
  * Đa phương tiện: Hỗ trợ gửi hình ảnh, tệp, liên kết với preview.
  * Emoji & Reactions: Hỗ trợ biểu tượng cảm xúc và phản ứng với tin nhắn.

* Module Lịch (Calendar):
  * Event Management: API để tạo, sửa, xóa và xem sự kiện.
  * Recurring Events: Hỗ trợ sự kiện lặp lại.
  * Notifications: Thông báo nhắc nhở trước sự kiện.
  * Resource Booking: Đặt phòng họp và tài nguyên với kiểm tra xung đột.
  * Timezone Support: Hiển thị sự kiện theo múi giờ người dùng.

* Module Tài liệu (Docs):
  * Real-time Collaboration: Sử dụng Yjs và WebSockets.
  * Rich Text Editor: Dựa trên ProseMirror hoặc TipTap.
  * Spreadsheet: Tính năng bảng tính cơ bản.
  * Presentation: Trình bày slide đơn giản.
  * Versioning: Quản lý phiên bản và lịch sử chỉnh sửa.
  * Permission Control: Quản lý ai có thể xem/chỉnh sửa/chia sẻ tài liệu.

* Module Lưu trữ Đám Mây (Cloud Drive):
  * File Operations API: Upload, download, di chuyển, đổi tên, xóa.
  * Sharing System: Chia sẻ với người dùng khác hoặc qua link.
  * Versioning: Lưu phiên bản tệp tin.
  * Thumbnail Generation: Tạo ảnh thu nhỏ cho hình ảnh và preview tệp phổ biến.
  * Search: Tìm kiếm theo tên, loại, nội dung tệp.

* Module Email Tích Hợp:
  * SMTP/IMAP Client: Kết nối với máy chủ email.
  * Email Composer: Soạn thảo email với định dạng rich text.
  * Email Organization: Phân loại và lọc email.
  * Attachment Handling: Gửi và nhận tệp đính kèm.
  * Integration: Tích hợp với Calendar, Tasks, và Docs.

* Module Quản lý Công Việc & Dự Án:
  * Task Management: API cho tạo, gán, theo dõi công việc.
  * Project Organization: Nhóm các công việc theo dự án.
  * Views: Hiển thị theo dạng danh sách, bảng Kanban, timeline.
  * Subtasks & Dependencies: Công việc con và phụ thuộc giữa các công việc.
  * Notifications & Reminders: Nhắc nhở deadline và cập nhật công việc.

* Module Quy trình & Phê duyệt:
  * Workflow Designer: API để xây dựng quy trình phê duyệt.
  * Approval Routing: Định tuyến yêu cầu tới người phê duyệt phù hợp.
  * Status Tracking: Theo dõi trạng thái của yêu cầu phê duyệt.
  * Notifications: Thông báo cho người liên quan về cập nhật trạng thái.
  * Audit Trail: Lưu lịch sử đầy đủ của quy trình phê duyệt.

* Module Hội nghị Trực tuyến:
  * WebRTC Integration: Cho video/audio call.
  * Room Management: Tạo, quản lý phòng họp.
  * Screen Sharing: Chia sẻ màn hình và ứng dụng.
  * Recording: Ghi lại cuộc họp.
  * Whiteboard: Bảng trắng kỹ thuật số để cộng tác.

* Module Quản trị Hệ thống (Admin Console):
  * User Management: API để quản lý người dùng, phòng ban, vai trò.
  * System Configuration: Cấu hình chung cho hệ thống.
  * Monitoring: Giám sát hiệu suất và hoạt động.
  * Audit & Compliance: Theo dõi hoạt động người dùng và admin.
  * Backup & Restore: Sao lưu và phục hồi dữ liệu.

* Module Nền tảng Mở (Open Platform):
  * REST API: API cho các ứng dụng bên ngoài.
  * Webhooks: Thông báo sự kiện ra ngoài.
  * Authentication: OAuth2 để xác thực ứng dụng bên thứ ba.
  * SDK: Thư viện hỗ trợ để phát triển tích hợp.
  * Developer Portal: Tài liệu và công cụ cho nhà phát triển.

VIII. Mở rộng & Tối ưu hóa

* Khi cần mở rộng:
  * Chuyển từ SQLite sang PostgreSQL.
  * Tách các module thành dịch vụ riêng biệt.
  * Thiết lập thêm server và load balancing.

* Tối ưu hóa hiệu năng:
  * Database indexing phù hợp.
  * Caching với Redis.
  * Thiết kế API hướng tới việc giảm số lượng requests.
  * Lazy loading cho dữ liệu lớn.

* Kế hoạch sao lưu:
  * Scheduled backup scripts cho database và files.
  * Versioning đơn giản cho tài liệu.

* Offline Support:
  * Sử dụng Service Workers để cung cấp chức năng offline cơ bản.
  * Đồng bộ hóa khi kết nối mạng trở lại.

Lưu ý:

* Kiến trúc này được tối ưu hóa cho việc triển khai đơn giản trên một máy chủ Windows, phù hợp với quy mô khoảng 30 người dùng.
* Khi cần mở rộng, kiến trúc có thể dần chuyển sang mô hình distributed hoặc microservices.
* Các công nghệ được chọn đều phải tương thích tốt với Windows và dễ dàng cài đặt/cấu hình.
* Nên ưu tiên tính ổn định và dễ bảo trì hơn là các công nghệ phức tạp mới nhất.
